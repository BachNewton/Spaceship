<!DOCTYPE html>
<html>

<head>
    <title>Spaceship</title>

    <style>
        body {
            background-color: black;
            color: white;
        }

        canvas {
            border: 1px solid white;
        }
    </style>
</head>

<body>
    <canvas id="canvas" width="1280" height="720"></canvas>
    <br> Use 'WASD' to fire your thrusters
    <br> Click to shoot your lasers
    <br> Scroll to zoom in and out
    <br> Press 'F' to drop a space station block

    <script>
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext("2d");
        var mouse = { x: -1, y: -1 };
        var mouseHeld = false;
        var keysHeld = {};
        var globalScale = 1;
        var MAX_DEPTH = 5;
        var ROOT_GRID = new Grid(-100000, 100000, -100000, 100000, 0);
        var frameStopwatch = new FrameStopwatch();
        var debugMode = false;
        var debugKeyWasReleased = true;
        var debugKeyWasPressed = false;
        document.getElementById('canvas').addEventListener('mousedown', mouseDown);
        document.getElementById('canvas').addEventListener('mouseup', mouseUp);
        document.getElementById('canvas').addEventListener('mousemove', updateMousePosition);
        document.getElementById('canvas').addEventListener('wheel', scrollWheel);
        document.addEventListener('keydown', keyDown);
        document.addEventListener('keyup', keyUp);

        var spaceship = new Spaceship();
        var lasers = [];
        var asteroids = [];
        var explosions = [];
        var blocks = [];
        var asteroidImage = new Image();
        asteroidImage.src = "Resources/Images/asteroid.png";
        var explosionImage = new Image();
        explosionImage.src = "Resources/Images/explosion.png";

        asteroids.push(new Asteroid(canvas.width * 0.2, canvas.height * 0.2, 1, 0, 1, Math.PI / 256));
        asteroids.push(new Asteroid(canvas.width * 0.8, canvas.height * 0.2, 0, 1, 1, Math.PI / 256));
        asteroids.push(new Asteroid(canvas.width * 0.2, canvas.height * 0.8, 0, -1, 1, Math.PI / 256));
        asteroids.push(new Asteroid(canvas.width * 0.8, canvas.height * 0.8, -1, 0, 1, Math.PI / 256));

        var density = 4000;
        for (var i = 0; i < density; i++) {
            asteroids.push(new Asteroid(Math.random() * 200000 - 100000, Math.random() * 200000 - 100000, Math.random() * 10 - 5, Math.random() * 10 - 5, Math.random() * 2.75 + 0.25, Math.PI / 256));
        }

        var FPS = 60;
        var INTERVAL = 1000 / FPS;
        var then = 0;
        draw();

        function draw(timestamp) {
            requestAnimationFrame(draw);

            var delta = timestamp - then;

            if (delta > INTERVAL) {
                then = timestamp - (delta % INTERVAL);
                frame();
            }
        }

        function frame() {
            frameStopwatch.reset();
            debugCheck();
            moveCamera();
            drawAsteroids();
            drawBlocks();
            drawSpaceship();
            drawLasers();
            drawExplosions();
            drawHUD();
        }

        function debugCheck() {
            // \
            if (keysHeld[220]) {
                debugKeyWasPressed = true;
                if (debugKeyWasReleased) {
                    debugMode = !debugMode;
                    debugKeyWasReleased = false;
                }
            } else {
                if (debugKeyWasPressed) {
                    debugKeyWasReleased = true;
                }
            }
        }

        function moveCamera() {
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.setTransform(globalScale, 0, 0, globalScale, -(globalScale - 1) * canvas.width / 2, -(globalScale - 1) * canvas.height / 2);
            ctx.translate(-spaceship.x + canvas.width / 2, -spaceship.y + canvas.height / 2);
        }

        function drawAsteroids() {
            for (var i = 0; i < asteroids.length; i++) {
                asteroids[i].draw();

                if (debugMode) {
                    asteroids[i].drawHitBox();
                }

                asteroids[i].move();
            }
        }

        function drawBlocks() {
            for (var i = 0; i < blocks.length; i++) {
                blocks[i].draw();

                ctx.fillStyle = 'white';
                ctx.font = '75px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(i, blocks[i].x, blocks[i].y);

                blocks[i].move();

                if (!blocks[i].connected) {
                    var zone = blocks[i].grid.objects.blocks;

                    for (var j = 0; j < zone.length; j++) {
                        blocks[i].checkConnection(zone[j]);
                        if (blocks[i].connected) {
                            break;
                        }
                    }
                }
            }
        }

        function drawSpaceship() {
            spaceship.draw();

            if (debugMode) {
                spaceship.drawHitBox();
            }

            spaceship.update();
            spaceship.move();

            var zone = ROOT_GRID.getGrid(spaceship.x, spaceship.y).objects.asteroids;

            for (var i = 0; i < zone.length; i++) {
                if (spaceship.collideWith(zone[i])) {
                    spaceship.hit();
                }
            }
        }

        function drawLasers() {
            for (var i = 0; i < lasers.length; i++) {
                lasers[i].draw();
                lasers[i].move();

                var point = lasers[i].getCollisionPoint();
                var grid = ROOT_GRID.getGrid(point.x, point.y);
                var zone = grid.objects.asteroids;

                if (debugMode) {
                    grid.highlight();
                }

                for (var j = 0; j < zone.length; j++) {
                    if (debugMode) {
                        zone[j].mark();
                    }

                    if (lasers[i].collideWith(zone[j])) {
                        explosions.push(new Explosion(point.x, point.y, zone[j].xVel, zone[j].yVel));
                        lasers.splice(i, 1);
                        i--;
                        var index = asteroids.indexOf(zone[j]);
                        asteroids.splice(index, 1);
                        zone.splice(j, 1);
                        break;
                    }
                }
            }
        }

        function drawExplosions() {
            for (var i = 0; i < explosions.length; i++) {
                explosions[i].draw();
                explosions[i].update();
                explosions[i].move();

                if (explosions[i].life <= 0) {
                    explosions.splice(i, 1);
                    i--;
                }
            }
        }

        function drawHUD() {
            ctx.save();
            ctx.setTransform(1, 0, 0, 1, 0, 0);

            ctx.fillStyle = 'white';
            ctx.font = '30px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Remaining Asteroids: ' + asteroids.length.toLocaleString('en'), 4, 34);

            if (spaceship.hitPoints <= 0) {
                ctx.fillStyle = 'red';
                ctx.font = '150px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('GAME OVER!', canvas.width / 2, canvas.height / 2 + 75);
            }

            ctx.restore();

            spaceship.drawHearts();

            if (debugMode) {
                ROOT_GRID.draw();
                frameStopwatch.draw();
            }
        }

        function Block(x, y, xVel, yVel) {
            this.x = x;
            this.y = y;
            this.xVel = xVel;
            this.yVel = yVel;
            this.grid = ROOT_GRID.getGrid(this.x, this.y);
            this.grid.objects.blocks.push(this);
            this.connected = false;
            this.images = {
                body: spaceship.images.block
            };

            this.draw = function () {
                ctx.drawImage(this.images.body.image, this.x - this.images.body.image.width / 2, this.y - this.images.body.image.height / 2, this.images.body.image.width, this.images.body.image.height);
            };

            this.move = function () {
                this.moveTo(this.x + this.xVel, this.y + this.yVel);
            };

            this.moveTo = function (x, y) {
                var newGrid = ROOT_GRID.getGrid(x, y);

                if (this.grid != newGrid) {
                    var index = this.grid.objects.blocks.indexOf(this);
                    this.grid.objects.blocks.splice(index, 1);
                    newGrid.objects.blocks.push(this);
                    this.grid = newGrid;
                }

                this.x = x;
                this.y = y;
            };

            this.getCollisionRect = function () {
                return {
                    x: this.x - this.images.body.image.width / 2,
                    y: this.y - this.images.body.image.height / 2,
                    width: this.images.body.image.width,
                    height: this.images.body.image.height
                };
            };

            this.checkConnection = function (block) {
                if (this != block) {
                    var rect1 = this.getCollisionRect();
                    var rect2 = block.getCollisionRect();

                    if (rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x && rect1.y < rect2.y + rect2.height && rect1.height + rect1.y > rect2.y) {
                        var foundConnection = false;

                        var deltaX = this.x - block.x;
                        var deltaY = this.y - block.y;

                        if (Math.abs(deltaX) > Math.abs(deltaY)) {
                            // Left Side
                            if (block.left == undefined && deltaX < 0) {
                                this.x = block.x - rect2.width;
                                this.y = block.y;
                                block.left = this;
                                this.right = block;
                                foundConnection = true;
                            }
                            // Right Side
                            else if (block.right == undefined && deltaX >= 0) {
                                this.x = block.x + rect2.width;
                                this.y = block.y;
                                block.right = this;
                                this.left = block;
                                foundConnection = true;
                            }
                        } else {
                            // Top Side
                            if (block.top == undefined && deltaY < 0) {
                                this.y = block.y - rect2.height;
                                this.x = block.x;
                                block.top = this;
                                this.bottom = block;
                                foundConnection = true;
                            }
                            // Bottom Side
                            else if (block.bottom == undefined && deltaY >= 0) {
                                this.y = block.y + rect2.height;
                                this.x = block.x;
                                block.bottom = this;
                                this.top = block;
                                foundConnection = true;
                            }
                        }

                        if (foundConnection) {
                            this.connected = true;
                            block.connected = true;
                            this.xVel = block.xVel;
                            this.yVel = block.yVel;
                        }
                    }
                }
            };
        }

        function Spaceship() {
            this.x = canvas.width / 2;
            this.y = canvas.height / 2;
            this.xVel = 0;
            this.yVel = 0;
            this.thrust = 0.25;
            this.laserSpeed = 25;
            this.laserCooldown = 0;
            this.laserCooldownFilled = 15;
            this.blockCooldown = 0;
            this.blockCooldownFilled = 30;
            this.hitPoints = 10;
            this.invicibilityFrames = 0;
            this.visable = true;
            this.visableCounter = 0;
            this.rcsUp = false;
            this.rcsLeft = false;
            this.rcsDown = false;
            this.rcsRight = false;
            this.images = {
                body: { image: new Image() },
                rcs: { image: new Image() },
                gun: { image: new Image() },
                laser: { image: new Image() },
                heart: { image: new Image() },
                block: { image: new Image() }
            };

            this.images.body.image.src = "Resources/Images/spaceship.png";
            this.images.body.scale = 0.2;

            this.images.rcs.image.src = "Resources/Images/rcs.png";
            this.images.rcs.scale = 0.2;

            this.images.gun.image.src = "Resources/Images/gun.png";
            this.images.gun.scale = 0.15;

            this.images.laser.image.src = "Resources/Images/laser.jpg";
            this.images.laser.scale = 0.5;

            this.images.heart.image.src = "Resources/Images/heart.png";
            this.images.heart.scale = 0.04;

            this.images.block.image.src = "Resources/Images/block.jpg";
            this.images.block.scale = 0.25;

            this.draw = function () {
                if (this.visable) {
                    if (this.rcsUp) {
                        ctx.save();
                        ctx.translate(this.x, this.y);
                        ctx.drawImage(this.images.rcs.image, 0 - this.images.rcs.scale * this.images.rcs.image.width / 2, 0 - this.images.rcs.scale * this.images.rcs.image.height, this.images.rcs.scale * this.images.rcs.image.width, this.images.rcs.scale * this.images.rcs.image.height);
                        ctx.restore();
                    }

                    if (this.rcsRight) {
                        ctx.save();
                        ctx.translate(this.x, this.y);
                        ctx.rotate(Math.PI / 2);
                        ctx.drawImage(this.images.rcs.image, 0 - this.images.rcs.scale * this.images.rcs.image.width / 2, 0 - this.images.rcs.scale * this.images.rcs.image.height, this.images.rcs.scale * this.images.rcs.image.width, this.images.rcs.scale * this.images.rcs.image.height);
                        ctx.restore();
                    }

                    if (this.rcsDown) {
                        ctx.save();
                        ctx.translate(this.x, this.y);
                        ctx.rotate(Math.PI);
                        ctx.drawImage(this.images.rcs.image, 0 - this.images.rcs.scale * this.images.rcs.image.width / 2, 0 - this.images.rcs.scale * this.images.rcs.image.height, this.images.rcs.scale * this.images.rcs.image.width, this.images.rcs.scale * this.images.rcs.image.height);
                        ctx.restore();
                    }

                    if (this.rcsLeft) {
                        ctx.save();
                        ctx.translate(this.x, this.y);
                        ctx.rotate(Math.PI * 3 / 2);
                        ctx.drawImage(this.images.rcs.image, 0 - this.images.rcs.scale * this.images.rcs.image.width / 2, 0 - this.images.rcs.scale * this.images.rcs.image.height, this.images.rcs.scale * this.images.rcs.image.width, this.images.rcs.scale * this.images.rcs.image.height);
                        ctx.restore();
                    }

                    ctx.drawImage(this.images.body.image, this.x - this.images.body.scale * this.images.body.image.width / 2, this.y - this.images.body.scale * this.images.body.image.height / 2, this.images.body.scale * this.images.body.image.width, this.images.body.scale * this.images.body.image.height);

                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.getGunAngle() + Math.PI / 2);
                    ctx.drawImage(this.images.gun.image, 0 - this.images.gun.scale * this.images.gun.image.width / 2, 0 - this.images.gun.scale * this.images.gun.image.height, this.images.gun.scale * this.images.gun.image.width, this.images.gun.scale * this.images.gun.image.height);
                    ctx.restore();
                }
            };

            this.drawHearts = function () {
                ctx.save();
                ctx.setTransform(1, 0, 0, 1, 0, 0);

                for (var i = 0; i < this.hitPoints; i++) {
                    ctx.drawImage(this.images.heart.image, canvas.width - this.images.heart.image.width * this.images.heart.scale * (i + 1), canvas.height - this.images.heart.image.height * this.images.heart.scale, this.images.heart.image.width * this.images.heart.scale, this.images.heart.image.height * this.images.heart.scale);
                }

                ctx.restore();
            };

            this.drawHitBox = function () {
                var grid = ROOT_GRID.getGrid(this.x, this.y);
                ctx.fillStyle = grid.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.images.body.image.height * this.images.body.scale / 2, 0, 2 * Math.PI);
                ctx.fill();
            };

            this.hit = function () {
                if (this.invicibilityFrames <= 0) {
                    this.hitPoints--;
                    this.invicibilityFrames = 180;
                    explosions.push(new Explosion(this.x, this.y, this.xVel, this.yVel));
                }
            };

            this.update = function () {
                this.laserCooldown--;
                this.blockCooldown--;
                this.invicibilityFrames--;

                if (this.invicibilityFrames > 0) {
                    this.visableCounter++;
                    if (this.visableCounter >= 15) {
                        this.visable = !this.visable;
                        this.visableCounter = 0;
                    }
                } else {
                    this.visable = true;
                }

                // W
                if (keysHeld[87]) {
                    this.thrustUp();
                } else {
                    this.thrustUpStop();
                }

                // A
                if (keysHeld[65]) {
                    this.thrustLeft();
                } else {
                    this.thrustLeftStop();
                }

                // S
                if (keysHeld[83]) {
                    this.thrustDown();
                } else {
                    this.thrustDownStop();
                }

                // D
                if (keysHeld[68]) {
                    this.thrustRight();
                } else {
                    this.thrustRightStop();
                }

                // F
                if (keysHeld[70]) {
                    if (this.blockCooldown <= 0) {
                        blocks.push(new Block(this.x, this.y, this.xVel, this.yVel));
                        this.blockCooldown = this.blockCooldownFilled;
                    }
                }

                // Mouse Held
                if (mouseHeld) {
                    if (this.laserCooldown <= 0) {
                        lasers.push(new Laser(this));
                        this.laserCooldown = this.laserCooldownFilled;
                    }
                }
            };

            this.thrustUp = function () {
                this.yVel -= this.thrust;
                this.rcsDown = true;
            };

            this.thrustUpStop = function () {
                this.rcsDown = false;
            };

            this.thrustLeft = function () {
                this.xVel -= this.thrust;
                this.rcsRight = true;
            };

            this.thrustLeftStop = function () {
                this.rcsRight = false;
            };

            this.thrustDown = function () {
                this.yVel += this.thrust;
                this.rcsUp = true;
            };

            this.thrustDownStop = function () {
                this.rcsUp = false;
            };

            this.thrustRight = function () {
                this.xVel += this.thrust;
                this.rcsLeft = true;
            };

            this.thrustRightStop = function () {
                this.rcsLeft = false;
            };

            this.move = function () {
                this.x += this.xVel;
                this.y += this.yVel;
            };

            this.getGunAngle = function () {
                return Math.atan2(mouse.y - canvas.height / 2, mouse.x - canvas.width / 2);
            };

            this.getDistanceTo = function (circle) {
                return Math.hypot(circle.y - this.y, circle.x - this.x);
            };

            this.collideWith = function (circle) {
                return this.getDistanceTo(circle) < circle.images.body.image.width * circle.images.body.scale / 2 + this.images.body.image.height * this.images.body.scale / 2;
            };
        }

        function Laser(spaceship) {
            this.x = spaceship.x;
            this.y = spaceship.y;
            this.angle = spaceship.getGunAngle();
            this.xVel = spaceship.xVel + Math.cos(this.angle) * spaceship.laserSpeed;
            this.yVel = spaceship.yVel + Math.sin(this.angle) * spaceship.laserSpeed;
            this.images = {
                laser: spaceship.images.laser
            };

            this.draw = function () {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle + Math.PI / 2);
                ctx.drawImage(this.images.laser.image, 0 - this.images.laser.scale * this.images.laser.image.width / 2, 0 - this.images.laser.scale * this.images.laser.image.height, this.images.laser.scale * this.images.laser.image.width, this.images.laser.scale * this.images.laser.image.height);
                ctx.restore();
            };

            this.move = function () {
                this.x += this.xVel;
                this.y += this.yVel;
            }

            this.getCollisionPoint = function () {
                return {
                    x: this.x + this.images.laser.image.height * this.images.laser.scale * Math.cos(this.angle),
                    y: this.y + this.images.laser.image.height * this.images.laser.scale * Math.sin(this.angle)
                };
            };

            this.getDistanceTo = function (asteroid) {
                var point = this.getCollisionPoint();
                return Math.hypot(asteroid.y - point.y, asteroid.x - point.x);
            };

            this.collideWith = function (asteroid) {
                return this.getDistanceTo(asteroid) < asteroid.images.body.image.width * asteroid.images.body.scale / 2;
            };
        }

        function Asteroid(x, y, xVel, yVel, size, rotationalSpeed) {
            this.x = x;
            this.y = y;
            this.xVel = xVel;
            this.yVel = yVel;
            this.grid = ROOT_GRID.getGrid(this.x, this.y);
            this.grid.objects.asteroids.push(this);
            this.size = size;
            this.rotation = 0;
            this.rotationalSpeed = rotationalSpeed;
            this.images = {
                body: { image: asteroidImage }
            };

            this.images.body.scale = this.size;

            this.draw = function () {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.drawImage(this.images.body.image, 0 - this.images.body.scale * this.images.body.image.width / 2, 0 - this.images.body.scale * this.images.body.image.height / 2, this.images.body.scale * this.images.body.image.width, this.images.body.scale * this.images.body.image.height);
                ctx.restore();
            };

            this.drawHitBox = function () {
                ctx.fillStyle = this.grid.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.images.body.image.width * this.images.body.scale / 2, 0, 2 * Math.PI);
                ctx.fill();
            };

            this.mark = function () {
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 25;
                ctx.beginPath();
                ctx.moveTo(this.x - this.images.body.image.width * this.images.body.scale / 2, this.y - this.images.body.image.height * this.images.body.scale / 2);
                ctx.lineTo(this.x + this.images.body.image.width * this.images.body.scale / 2, this.y + this.images.body.image.height * this.images.body.scale / 2);
                ctx.moveTo(this.x + this.images.body.image.width * this.images.body.scale / 2, this.y - this.images.body.image.height * this.images.body.scale / 2);
                ctx.lineTo(this.x - this.images.body.image.width * this.images.body.scale / 2, this.y + this.images.body.image.height * this.images.body.scale / 2);
                ctx.stroke();
            };

            this.move = function () {
                this.rotation += this.rotationalSpeed;
                this.moveTo(this.x + this.xVel, this.y + this.yVel);
            };

            this.moveTo = function (x, y) {
                var newGrid = ROOT_GRID.getGrid(x, y);

                if (this.grid != newGrid) {
                    var index = this.grid.objects.asteroids.indexOf(this);
                    this.grid.objects.asteroids.splice(index, 1);
                    newGrid.objects.asteroids.push(this);
                    this.grid = newGrid;
                }

                this.x = x;
                this.y = y;
            };
        }

        function Explosion(x, y, xVel, yVel) {
            this.x = x;
            this.y = y;
            this.xVel = xVel;
            this.yVel = yVel;
            this.life = 40;
            this.images = {
                body: { image: explosionImage }
            };

            this.images.body.scale = 0.025;

            this.draw = function () {
                ctx.drawImage(this.images.body.image, this.x - this.images.body.scale * this.images.body.image.width / 2, this.y - this.images.body.scale * this.images.body.image.height / 2, this.images.body.scale * this.images.body.image.width, this.images.body.scale * this.images.body.image.height);
            }

            this.move = function () {
                this.x += this.xVel;
                this.y += this.yVel;
            };

            this.update = function () {
                this.life--;
                this.images.body.scale *= 1.05;
            };
        }

        function mouseDown(evt) {
            mouseHeld = true;
        }

        function mouseUp(evt) {
            mouseHeld = false;
        }

        function keyDown(evt) {
            keysHeld[evt.keyCode] = true;
        }

        function keyUp(evt) {
            keysHeld[evt.keyCode] = false;
        }

        function updateMousePosition(evt) {
            var rect = canvas.getBoundingClientRect();
            mouse.x = evt.clientX - rect.left;
            mouse.y = evt.clientY - rect.top;
        }

        function scrollWheel(evt) {
            var magnitude = evt.deltaY;
            var zoomPower = 5000;

            if (magnitude < 0) {
                magnitude *= -1;
                globalScale *= 1 + (magnitude / zoomPower);
            } else {
                globalScale *= 1 - (magnitude / zoomPower);
            }
        }

        function Grid(leftBound, rightBound, topBound, bottomBound, depth) {
            this.centerX = (leftBound + rightBound) / 2;
            this.centerY = (topBound + bottomBound) / 2;

            if (depth >= MAX_DEPTH) {
                this.objects = {
                    asteroids: [],
                    blocks: []
                };
                this.color = getRandomColor(0.8);
                this.leftBound = leftBound;
                this.rightBound = rightBound;
                this.topBound = topBound;
                this.bottomBound = bottomBound;
            } else {
                this.topLeft = new Grid(leftBound, this.centerX, topBound, this.centerY, depth + 1);
                this.topRight = new Grid(this.centerX, rightBound, topBound, this.centerY, depth + 1);
                this.bottomLeft = new Grid(leftBound, this.centerX, this.centerY, bottomBound, depth + 1);
                this.bottomRight = new Grid(this.centerX, rightBound, this.centerY, bottomBound, depth + 1);
            }

            this.getGrid = function (x, y) {
                if (this.objects != undefined) {
                    return this;
                } else {
                    if (x < this.centerX && y < this.centerY) {
                        return this.topLeft.getGrid(x, y);
                    } else if (x >= this.centerX && y < this.centerY) {
                        return this.topRight.getGrid(x, y);
                    } else if (x < this.centerX && y >= this.centerY) {
                        return this.bottomLeft.getGrid(x, y);
                    } else {
                        return this.bottomRight.getGrid(x, y);
                    }
                }
            };

            this.draw = function () {
                if (this.objects != undefined) {
                    ctx.strokeStyle = 'yellow';
                    ctx.lineWidth = 50;
                    ctx.strokeRect(this.leftBound, this.topBound, this.rightBound - this.leftBound, this.bottomBound - this.topBound);
                } else {
                    this.topLeft.draw();
                    this.topRight.draw();
                    this.bottomLeft.draw();
                    this.bottomRight.draw();
                }
            };

            this.highlight = function () {
                ctx.fillStyle = 'rgba(255,255,0,0.1)';
                ctx.fillRect(this.leftBound, this.topBound, this.rightBound - this.leftBound, this.bottomBound - this.topBound);
            };
        }

        function FrameStopwatch() {
            this.startTime = performance.now();

            this.reset = function () {
                this.startTime = performance.now();
            };

            this.draw = function () {
                var time = Math.floor(performance.now() - this.startTime);

                ctx.save();
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.fillStyle = 'lime';
                ctx.font = '15px Arial';
                ctx.fillText('Time / Frame: ' + time + 'ms', 4, canvas.height - 4);
                ctx.restore();
            };
        }

        function getRandomColor(alpha) {
            var r = Math.floor(Math.random() * 256);
            var g = Math.floor(Math.random() * 256);
            var b = Math.floor(Math.random() * 256);
            return 'rgba(' + r + ',' + g + ',' + b + ',' + alpha + ')';
        }
    </script>
</body>